target_default: 4_pb_model

packages:
  - sf
  - yaml
  - dplyr
  - scipiper
  - ncdf4

sources:
  - utils/src/EnKF_functions.R
  - 4_pb_model/src/nc_utils.R

targets:
  4_pb_model:
    depends:

# create ensemble of PRMS-SNTemp runs with varying drivers and parameters
  n_en:
    command: model_settings[[I('n_en')]]

  pb_start:
    command: model_settings[[I('start')]]

  pb_stop:
    command: model_settings[[I('stop')]]

  pb_dates:
    command: get_model_dates(pb_start, pb_stop)

  project_id:
    command: model_settings[[I('project_id')]]

  pb_model_states:
    command: model_settings[[I('states')]]

# create nc model output for storing PRMS-SNTemp variables
  4_pb_model/out/pb_pretrain_model_output.nc.ind:
    command: nc_create_pb_pretrain_out(
      model_locations_ind = '1_model_fabric/out/model_locations.rds.ind',
      n_en = n_en,
      dates = pb_dates,
      project_id = project_id,
      vars = pb_model_states,
      nc_name_out_ind = target_name)


